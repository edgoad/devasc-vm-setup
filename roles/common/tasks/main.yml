---
- name: Set hostname
  hostname:
    name: "{{ hostname }}"

- name: Ensure /etc/hosts has hostname entry
  lineinfile:
    path: /etc/hosts
    regexp: '^(127\.0\.1\.1\s+).*'
    line: "127.0.1.1   {{ hostname }}"

- name: Disable idle delay systemwide (try global setting)
  shell: |
    current=$(gsettings get org.gnome.desktop.session idle-delay 2>/dev/null || echo "uint32 60000")
    if [ "$current" != "uint32 0" ]; then
      gsettings set org.gnome.desktop.session idle-delay 0
      echo "changed"
    fi
  register: idle_delay_result
  changed_when: "'changed' in idle_delay_result.stdout"
  ignore_errors: yes

# Add commonly used apt keys (can be extended by packages role)
- name: Add apt key for docker
  apt_key:
    url: https://download.docker.com/linux/ubuntu/gpg
    state: present

# trigger an apt update handler if needed
- meta: flush_handlers